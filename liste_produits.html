<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Gestion bijouterie</title>
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
    <link href="css/sweetalert2.min.css">
    <link href="css/style.css" rel="stylesheet" type="text/css">
    <link href="css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <script src="js/jquery-3.6.0.min.js" ></script>
    <script src="js/bootstrap.bundle.min.js" ></script>
    <script src="js/sweetalert2.all.min.js"></script>
    <script src="js/download.js"></script>
</head>
<body style="background: white;">
    
    <div class="mt-5"> 
  
    <!--<div class="col-md-4 mb-2">
      <input type="text" id="search_ref" class="form-control" placeholder="Rechercher par référence">
    </div>-->
    <div class="col-md-4 float-left" style="position: relative;">
      <h3 class="title_page_2" >LISTE <span>DES ARTICLES</span></h3>
      <img  src="images/bijoux.jpg" style="max-width: 100%;height: 100%;">
    </div>

    <div  class="col-md-8 float-left">
  <table class="table table-bordered">
    <thead>
      <tr>
        <th scope="col">#</th>
        <th scope="col">Référence</th>
        <!--<th scope="col">Bare code</th>-->
        <th scope="col">Désignation</th>
        <th scope="col">Prix d'achat (DH)</th>
        <th scope="col">Poids (g)</th>
        <th scope="col">Action</th>
      </tr>
    </thead>
    <tbody id="liste">
      
    </tbody>
  </table>
</div>
    </div>


    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Modifier</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
             
                <!--<div class="form-group col-md-4 float-left">
                    <label >Référence</label>
                    <input type="text" name="reference" id="reference" class="form-control" >
                  </div>-->

                  <div class="form-group col-md-3 float-left">
                    <label >Catégorie</label>
                    <div id="select_catig"></div>
                  </div>

                  <!--<div class="form-group col-md-4 float-left">
                    <label >Référence</label>
                    <input type="text" name="bare_code" id="bare_code" class="form-control" >
                  </div>-->

                  <div class="form-group col-md-3 float-left">
                    <label >Date de création d'article</label>
                    <input type="date" name="date" id="date"  class="form-control" >
                  </div>
                
                  <div class="form-group col-md-3 float-left">
                    <label >Désignation</label>
                    <input type="text" name="nom" id="nom" class="form-control" >
                  </div>
                
                  
                
                 <!-- <div class="form-group col-md-4 float-left">
                    <label >Gestion par :</label>
                    <select class="form-control" name="type" id="type">
                       <option value="1">Objet</option>
                       <option value="2">Lot</option>
                      </select>
                  </div>-->

                    <div class="form-group col-md-3 float-left">
                    <label >Poids (g)</label>
                    <input type="text" name="poids" id="poids" class="form-control" >
                    </div>

                  
                    <div class="form-group col-md-3 float-left">
                      <label >Prix au gramme  (DH)</label>
                      <input type="text" name="prix_gramme" id="prix_gramme"  class="form-control" >
                      </div>
                
                  

                    <div class="form-group col-md-3 float-left" id="div_poids_2" style="display: none;">
                      <label >Poids (carrat)</label>
                      <input type="text" name="poids_2" id="poids_2" class="form-control" >
                    </div>
                
                    <div class="form-group col-md-3 float-left" id="div_prix_2" style="display: none;">
                      <label >Prix d'achat 2 (DH)</label>
                      <input type="text" name="prix_2" id="prix_2"  class="form-control" >
                    </div>

                    <div class="form-group col-md-3 float-left">
                      <label >Prix d'achat  (DH)</label>
                      <input type="text" disabled name="prix" id="prix"  class="form-control" >
                      </div>

                      <div class="form-group col-md-3 float-left">
                        <label >Prix de vente (DH)</label>
                        <input type="text" name="prix_vente" id="prix_vente"  class="form-control" >
                      </div>
                   
                
                    <div class="form-group col-md-3 float-left">
                    <label >Quantité</label>
                    <input type="text" name="stock" id="stock" class="form-control" >
                    </div>

                    <div class="form-group col-md-3 float-left">
                      <label >Fournisseur</label>
                      <!--<div id="select_fournisseur"></div>-->
                      <input type="text" name="fournisseur" id="fournisseur" class="form-control" >
                    </div>
                
                    
                    <div class="form-group col-md-3 float-left">
                    <label >Description</label>
                    <textarea type="text" name="descrp" id="descrp" class="form-control" ></textarea>
                    </div>

                   

                    <input type="hidden" id="id_produit" value="">


            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Fermer</button>
              <button type="button" class="btn btn-primary submit_modify_produit">Modifier</button>
            </div>
          </div>
        </div>
      </div>


<script>
$(document).ready(function(){


   function sweetAlert(textA,iconA){
    Swal.fire({
  title: '',
  text: textA,
  icon: iconA,
  confirmButtonText: 'Ok'
});
   }


   $('#poids,#prix_gramme,#poids_2,#prix_2').keyup(function(){
             var poids = parseFloat($('#poids').val()) || 0;
             var prix_gramme = parseFloat($('#prix_gramme').val()) || 0;
             var poids_2 = parseFloat($('#poids_2').val()) || 0;
             var prix_2 = parseFloat($('#prix_2').val()) || 0;
             var catig= $("#catig").val();

             if(catig==16){
                 var prix_achat=(poids*prix_gramme)+(poids_2*prix_2);
             }else{
                 var prix_achat=(poids*prix_gramme);
             }

              $('#prix').val(prix_achat);
          });



       //START GET LISTE 
       $.ajax({
       url : 'https://www.proweb.ma/bijoux/module_produits.php',
       type : 'POST',
       dataType : 'html', 
       data : 'liste=true',
       success : function(data){ 
           $('#liste').html(data);
       }
     });
      //END GET LISTE 

        
  //START GET LISTE FOURNISSEUR SELECT
  $.ajax({
       url : 'https://www.proweb.ma/bijoux/module_fournisseur.php',
       type : 'POST',
       dataType : 'html', 
       data : 'select_fournisseur=true',
       success : function(data){ 
           $('#select_fournisseur').html(data);
       }
     });   
  //END   GET LISTE FOURNISSEUR SELECT

      //START GET LISTE CATIG SELECT
  $.ajax({
       url : 'https://www.proweb.ma/bijoux/module_catig.php',
       type : 'POST',
       dataType : 'html', 
       data : 'select_catig=true',
       success : function(data){ 
           $('#select_catig').html(data);
       }
     });   
  //END   GET LISTE CATIG SELECT


     //START GET DELET produit
      $(document).on("click",".delet_produit",function(){
          var id_produit=$(this).attr("id_produit");
      $.ajax({
       url : 'https://www.proweb.ma/bijoux/module_produits.php',
       type : 'POST',
       dataType : 'html', 
       data : 'delete_produit='+id_produit,
       success : function(data){ 
        if(data==1) window.location.href=""; 
       }
     });
    });
      //END GET DELET produit


      //START GET DETAIL product
      $(document).on("click",".get_produit",function(){
          var id_produit=$(this).attr("id_produit");
      $.ajax({
       url : 'https://www.proweb.ma/bijoux/module_produits.php',
       type : 'POST',
       dataType : 'html', 
       data : 'get_produit='+id_produit, 
       success : function(data){ 
         if(data) $("#exampleModal").modal('show');
        data = $.parseJSON(data);
        console.log(data);
        //$("#reference").val(data.reference);
        $("#bare_code").val(data.bare_code);
        $("#nom").val(data.nom);
        $("#poids").val(data.poids);
        $("#prix").val(data.prix);
        $("#stock").val(data.stock);
        $("#descrp").val(data.descrp);
        $("#id_produit").val(data.produits_id);
        $("#fournisseur").val(data.fournisseur);
        $("#date").val(data.date);
        $("#prix_2").val(data.prix_2);
        $("#poids_2").val(data.poids_2);
        $("#prix_gramme").val(data.prix_gramme);
        $("#prix_vente").val(data.prix_vente);
        
        if(data.catig==16){
         $("#div_poids_2").show();
         $("#div_prix_2").show();
        }else{
         $("#div_poids_2").hide();
         $("#div_prix_2").hide();
         $("#poids_2").val('');
         $("#prix_2").val('');
        }

        $("#type > option").each(function(){
          if($(this).val()==data.type) $(this).attr("selected","selected");
        });

        
        

        $("#catig > option").each(function(){
          var opt_val=$(this).val();
          if(opt_val==data.catig) $(this).attr('selected','selected');
        });


        //$("#fournisseur > option").each(function(){
         // var opt_val=$(this).val();
         // if(opt_val==data.fournisseur) $(this).attr('selected','selected');
        //});


       }
     });
    });
      //END GET DETAIL product


      //START MODIFY product
      $(document).on("click",".submit_modify_produit",function(){
       var reference= $("#reference").val();
       var bare_code= $("#bare_code").val();
       var nom= $("#nom").val();
       var poids= $("#poids").val();
       var prix= $("#prix").val();
       var stock= $("#stock").val();
       var descrp= $("#descrp").val();
       var id_produit= $("#id_produit").val();
       var catig= $("#catig").val();
       var fournisseur= $("#fournisseur").val();
       var type= $("#type").val();
       var date= $("#date").val();
       var poids_2= $("#poids_2").val();
       var prix_2= $("#prix_2").val(); 
       var prix_gramme= $("#prix_gramme").val(); 
       var prix_vente= $("#prix_vente").val();

       if(nom=="") sweetAlert("Nom est obligatoire",'error');
      else if(poids=="") sweetAlert("Poids est obligatoire",'error');
      else if(prix=="") sweetAlert("Prix est obligatoire",'error');
      else if(stock=="") sweetAlert("Stock est obligatoire",'error');
      else if(descrp=="") sweetAlert("description est obligatoire",'error');
      else if(fournisseur=="") sweetAlert("Fournisseur est obligatoire",'error');
      else{
      $.ajax({
       url : 'https://www.proweb.ma/bijoux/module_produits.php',
       type : 'POST',
       dataType : 'html', 
       data : 'catig='+catig+'&nom='+nom+"&reference="+reference+"&poids="+poids+"&prix="+prix+"&stock="+stock+"&descrp="+descrp+"&modify_product="+id_produit+"&fournisseur="+fournisseur+"&bare_code="+bare_code+"&type="+type+"&date="+date+"&poids_2="+poids_2+"&prix_2="+prix_2+"&prix_gramme="+prix_gramme+"&prix_vente="+prix_vente,
       success : function(data){ 
        if(data==1) window.location.href=""; 
       }
     });
    }
    });

      //START MODIFY product


      //SEARCH PRODUCT
      //let input = document.getElementById('search_ref');
      //let timeout = null;

     // input.addEventListener('keyup', function (e) {
     // clearTimeout(timeout);
      // var search_ref = $("#search_ref").val();
     //  timeout = setTimeout(function () {
        //console.log(search_ref);

      //  $.ajax({
      // url : 'https://www.proweb.ma/bijoux/search_ref.php',
      // type : 'POST',
      // dataType : 'html', 
      // data : 'search_ref='+search_ref,
       //success : function(data){ 
       // $('#liste').html(data);
      // }
    // });

      //}, 1000);
      //});
      //SEARCH PRODUCT


      //START CREATE BARCODE
       $(document).on("click",".get_bare_code_produit",function(){
      var id_produit=$(this).attr("id_produit");
      $.ajax({
       url : 'https://www.proweb.ma/bijoux/create_bare_code.php',
       type : 'POST',
       dataType : 'html', 
       data : 'id_produit='+id_produit, 
       success : function(data){ 
       console.log(data);
           
       if(data){
       var a = document.createElement('a');
       a.href = 'https://www.proweb.ma/bijoux/'+data;
       a.download = "output.png";
       document.body.appendChild(a);
       a.click();
       document.body.removeChild(a);
      }
       }
     });
       });
      //END   CREATE BARCODE

      //START CREATE TICKET
      $(document).on("click",".get_ticket",function(){
      var id_produit=$(this).attr("id_produit");
      var rv=$(this).attr("rv");
      $.ajax({
       url : 'https://www.proweb.ma/bijoux/generate_ticket_produit.php',
       type : 'POST',
       dataType : 'html', 
       data : 'id_produit='+id_produit+"&rv="+rv, 
       success : function(data){ 
       console.log(data);
       var v= Math.floor(Math.random() * 102586) + 1   
       if(data){
       var a = document.createElement('a');
       a.href = 'https://www.proweb.ma/bijoux/pdf_ticket/'+data+'.pdf?v='+v;
       a.download = "output.png";
       document.body.appendChild(a);
       a.click();
       document.body.removeChild(a);
      }
       }
     });
       });
      //END   CREATE TICKET



     

});


</script>


</body>
</html>
